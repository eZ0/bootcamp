jQuery(function(t){"use strict";Handlebars.registerHelper("eq",function(t,e,i){return t===e?i.fn(this):i.inverse(this)});var e=13,i=27,o={uuid:function(){var t,e,i="";for(t=0;32>t;t++)e=16*Math.random()|0,(8===t||12===t||16===t||20===t)&&(i+="-"),i+=(12===t?4:16===t?3&e|8:e).toString(16);return i},pluralize:function(t,e){return 1===t?e:e+"s"},store:function(t,e){if(arguments.length>1)return localStorage.setItem(t,JSON.stringify(e));var i=localStorage.getItem(t);return i&&JSON.parse(i)||[]}},s={init:function(){this.todos=o.store("todos-jquery"),this.cacheElements(),this.bindEvents(),new Router({"/:filter":function(t){this.filter=t,this.render()}.bind(this)}).init("/all")},cacheElements:function(){this.todoTemplate=Handlebars.compile(t("#todo-template").html()),this.footerTemplate=Handlebars.compile(t("#footer-template").html()),this.$todoApp=t("#todoapp"),this.$header=this.$todoApp.find("#header"),this.$main=this.$todoApp.find("#main"),this.$footer=this.$todoApp.find("#footer"),this.$newTodo=this.$header.find("#new-todo"),this.$toggleAll=this.$main.find("#toggle-all"),this.$todoList=this.$main.find("#todo-list"),this.$count=this.$footer.find("#todo-count"),this.$clearBtn=this.$footer.find("#clear-completed")},bindEvents:function(){var t=this.$todoList;this.$newTodo.on("keyup",this.create.bind(this)),this.$toggleAll.on("change",this.toggleAll.bind(this)),this.$footer.on("click","#clear-completed",this.destroyCompleted.bind(this)),t.on("change",".toggle",this.toggle.bind(this)),t.on("dblclick","label",this.edit.bind(this)),t.on("keyup",".edit",this.editKeyup.bind(this)),t.on("focusout",".edit",this.update.bind(this)),t.on("click",".destroy",this.destroy.bind(this))},render:function(){var t=this.getFilteredTodos();this.$todoList.html(this.todoTemplate(t)),this.$main.toggle(t.length>0),this.$toggleAll.prop("checked",0===this.getActiveTodos().length),this.renderFooter(),this.$newTodo.focus(),o.store("todos-jquery",this.todos)},renderFooter:function(){var t=this.todos.length,e=this.getActiveTodos().length,i=this.footerTemplate({activeTodoCount:e,activeTodoWord:o.pluralize(e,"item"),completedTodos:t-e,filter:this.filter});this.$footer.toggle(t>0).html(i)},toggleAll:function(e){var i=t(e.target).prop("checked");this.todos.forEach(function(t){t.completed=i}),this.render()},getActiveTodos:function(){return this.todos.filter(function(t){return!t.completed})},getCompletedTodos:function(){return this.todos.filter(function(t){return t.completed})},getFilteredTodos:function(){return"active"===this.filter?this.getActiveTodos():"completed"===this.filter?this.getCompletedTodos():this.todos},destroyCompleted:function(){this.todos=this.getActiveTodos(),this.filter="all",this.render()},indexFromEl:function(e){for(var i=t(e).closest("li").data("id"),o=this.todos,s=o.length;s--;)if(o[s].id===i)return s},create:function(i){var s=t(i.target),n=s.val().trim();i.which===e&&n&&(this.todos.push({id:o.uuid(),title:n,completed:!1}),s.val(""),this.render())},toggle:function(t){var e=this.indexFromEl(t.target);this.todos[e].completed=!this.todos[e].completed,this.render()},edit:function(e){var i=t(e.target).closest("li").addClass("editing").find(".edit");i.val(i.val()).focus()},editKeyup:function(o){o.which===e&&o.target.blur(),o.which===i&&t(o.target).data("abort",!0).blur()},update:function(e){var i=e.target,o=t(i),s=o.val().trim();if(o.data("abort"))return o.data("abort",!1),void this.render();var n=this.indexFromEl(i);s?this.todos[n].title=s:this.todos.splice(n,1),this.render()},destroy:function(t){this.todos.splice(this.indexFromEl(t.target),1),this.render()}};s.init()});